# 推論プロセス

## 概要
このドキュメントでは、学習済みモデルを使用して新しい美術作品の画像からキャプションを生成するプロセスについて説明します。

## 前処理
1. 画像を読み込み、RGB形式に変換
2. 訓練時と同様のリサイズと正規化を適用
3. エンコーダに通して特徴を抽出

## キャプション生成アルゴリズム

### ビームサーチ
デフォルトではビームサーチアルゴリズムを使用してキャプションを生成します：

1. 最初の単語として`<start>`トークンを使用
2. 各ステップで、現在までの候補シーケンスそれぞれに対して次の単語の確率を計算
3. 上位k個（ビーム幅）のシーケンスを保持
4. `<end>`トークンに達するか、最大長に達するまで繰り返す
5. 最終的に最も確率の高いシーケンスを選択

### グリーディ生成
簡易版の推論として、各ステップで最も確率の高い単語を選択する方法も実装されています。

### パラメータ
- ビーム幅：3（デフォルト）
- 温度：1.0（高いほど多様性が増す）
- 繰り返しペナルティ：2.0（同じ単語の繰り返しを抑制）

## アテンション可視化
`--visualize`オプションを使用すると、生成プロセス中の各単語に対するアテンション重みを可視化できます。これにより、モデルがどの画像領域に注目しているかを確認できます。

アテンションマップはモデルの意思決定プロセスを解釈する助けとなり、特定の単語を生成する際に関連する画像領域に適切に注目しているかを検証できます。